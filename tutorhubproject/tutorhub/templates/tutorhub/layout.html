{% load static %}
{% include 'tutorhub/modals/language_modal.html' %}

<!DOCTYPE html>
<html lang="en">

    <!-- HEAD -->
    <head>
        <title>{% block title %}Mentor{% endblock %}</title>
        <link rel="icon" type="image/svg+xml" href="{% static 'tutorhub/images/mentor-logo-bull.svg' %}">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'tutorhub/styles.css' %}">
    </head>
    <body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <a class="navbar-brand" href="{% url 'landing_page' %}">
            <!-- Navbar branding -->
            <div>
                <img class="navbar-logo" src="{% static '/tutorhub/images/mentor-logo-web.svg' %}" alt="Mentor Logo" class="logo">
            </div>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar Links -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto flex-row">
                {% if user.is_authenticated %}
                <li class="nav-item px-2"><a class="nav-link" id="menu-username" href="{% url 'my_profile' %}"><strong>{{ user.username }} ⚙️</strong></a></li>
                <li class="nav-item px-2"><a class="nav-link" id="menu-messages" href="{% url 'messages' %}">Messages</a></li>
                {% endif %}
                <li class="nav-item px-2"><a class="nav-link" id="menu-all-tutors" href="{% url 'index' %}">All Tutors</a></li>
                {% if user.is_authenticated %}
                <li class="nav-item px-2"><a class="nav-link" id="menu-following" href="{% url 'index' %}?view=following">Following</a></li>
                <li class="nav-item px-2"><a class="nav-link" href="{% url 'logout' %}">Log Out</a></li>
                {% else %}
                <li class="nav-item px-2"><a class="nav-link" href="{% url 'login' %}">Log In</a></li>
                <li class="nav-item px-2"><a class="nav-link" href="{% url 'register' %}">Register</a></li>
                {% endif %}
                <!-- language -->
                <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#languageModal"><img src="{% static 'tutorhub/images/language_icon.png' %}" alt="Language" height="20"> Language</a></li>
            </ul>
        </div>
    </nav>
    <div id="main-content">
        {% block body %}
        {% endblock %}
    </div>
    </body>

    <!-- FOOTER -->
    <footer class="footer bg-dark text-white mt-auto py-3">
        <div class="container footer-title">
            <div class="text-center mb-4">
                <div style="font-weight: bold;">MENTOR FINDER</div>
                <div>Brilliant teachers, just around the corner</div>
            </div>
            <div class="row">

                <!-- col 1 -->
                <div class="col-md-3 text-center">
                    <ul class="list-unstyled footer-links">
                        <li style="margin: 10px 0;"><a href="https://play.google.com/store/apps/details?id=your.app.id" target="_blank"><img src="{% static 'tutorhub/images/social_media_links/google_play.png' %}" alt="Get it on Google Play" width="120"></a></li>
                        <li style="margin: 10px 0;"><a href="https://play.google.com/store/apps/details?id=your.app.id" target="_blank"><img src="{% static 'tutorhub/images/social_media_links/app_store.png' %}" alt="Download on the App Store" width="120"></a></li>
                        <li style="margin: 10px 0;">
                            <img style="margin: 10px;" src="{% static 'tutorhub/images/social_media_links/facebook.png' %}" alt="Facebook" height="30">
                            <img style="margin: 10px;" src="{% static 'tutorhub/images/social_media_links/instagram.png' %}" alt="Instagram" height="30">
                            <img style="margin: 10px;" src="{% static 'tutorhub/images/social_media_links/x.png' %}" alt="X" height="30">
                            <img style="margin: 10px;" src="{% static 'tutorhub/images/social_media_links/youtube.png' %}" alt="youtube" height="30">
                        </li>
                    </ul>
                </div>

                <!-- col 2 -->
                <div class="col-md-3 text-center">
                    <div>
                        <ul class="list-unstyled footer-links">
                            <li>Support</li>
                            <li><a class="nav-link" href="#">Become a tutor</a></li>
                            <li><a class="nav-link" href="#">Get Certified</a></li>
                            <li><a class="nav-link" href="#">External Job Board</a></li>
                            <li><a class="nav-link" href="#">Help Center</a></li>
                        </ul>
                    </div>
                </div>

                <!-- col 3 -->
                <div class="col-md-3 text-center">
                    <div>
                        <ul class="list-unstyled footer-links">
                            <li>Company</li>
                            <li><a class="nav-link" href="#">About us</a></li>
                            <li><a class="nav-link" href="#">Our offerings</a></li>
                            <li><a class="nav-link" href="#">Careers at Mentor Finder</a></li>
                            <li><a class="nav-link" href="#">Newsroom</a></li>
                            <li><a class="nav-link" href="#">Investors</a></li>
                        </ul>
                    </div>
                </div>
                
                <!-- col 4 -->
                <div class="col-md-3 text-center">
                    <div>
                        <ul class="list-unstyled footer-links">
                            <li>Services</li>
                            <li><a class="nav-link" href="#">Private Lessons</a></li>
                            <li><a class="nav-link" href="#">Courses</a></li>
                            <li><a class="nav-link" href="#">Learning Resources</a></li>
                            <li><a class="nav-link" href="#">Teaching Resources</a></li>
                            <li><a class="nav-link" href="#">Administrative Resources</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <div>© {% now "Y" %} Mentor Finder. All rights reserved.</div>
                <div>Email: support@mentorfinder.com</div>
            </div>
        </div>
    </footer>

    <!--  Inline scripts -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const messagesLink = document.getElementById("menu-messages");

            if (!messagesLink) {
                console.error("Error: #menu-messages element not found.");
                return;
            }

            // Fetch unread message count
            fetch("{% url 'unread_messages_count' %}")
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Unread count:", data.unread_count);
                    if (data.unread_count > 0) {
                        messagesLink.classList.add("unread");
                        console.log(".unread class added to #menu-messages");
                    } else {
                        messagesLink.classList.remove("unread");
                        console.log(".unread class removed from #menu-messages");
                    }
                })
                .catch(err => console.error("Error fetching unread count:", err));
        });
    </script>
    
    <script src="{% static 'tutorhub/scripts.js' %}"></script>
</html>

<!-- Authentication status -->
<script type="application/json" id="auth-status">{{ user.is_authenticated|yesno:"true,false" }}</script>

<!-- Currently logged in user -->
<script>const loggedInUsername = "{{ request.user.username }}";</script>

<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

